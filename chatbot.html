<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CHATBOT PTC1</title>
  <style>
    /* Reset nh·∫π */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: #f5f7fb;
      color: #1f2937;
    }

    /* Thanh ti√™u ƒë·ªÅ */
    .appbar {
      position: sticky; top: 0; z-index: 10;
      background: #3b82f6; /* xanh lam */
      color: #fff;
      padding: 14px 16px;
      text-align: center;
      font-weight: 700;
      letter-spacing: .5px;
    }

    /* V√πng n·ªôi dung */
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
      padding-bottom: 92px; /* ch·ª´a ch·ªó cho thanh nh·∫≠p c·ªë ƒë·ªãnh */
    }

    /* Th·∫ª h∆∞·ªõng d·∫´n */
    .guide {
      background: #e9eef8;
      border-radius: 18px;
      padding: 18px 20px;
      margin: 10px auto 20px;
      box-shadow: 0 1px 0 rgba(0,0,0,.05) inset, 0 1px 2px rgba(0,0,0,.04);
      max-width: 1000px;
    }
    .guide h3 {
      margin: 0 0 10px;
      font-size: 16px;
      font-weight: 700;
    }
    .guide p { margin: 6px 0; line-height: 1.5; }
    .guide ul { margin: 8px 0 0 0; padding-left: 18px; }
    .guide li { margin: 6px 0; }

    /* Khung chat */
    .chat {
      max-width: 1000px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 45vh;
    }
    .msg {
      display: inline-flex;
      align-items: flex-start;
      gap: 10px;
      max-width: 92%;
    }
    .msg .bubble {
      padding: 10px 14px;
      border-radius: 14px;
      line-height: 1.5;
      word-wrap: break-word;
      white-space: pre-wrap;
      box-shadow: 0 1px 2px rgba(0,0,0,.04);
    }
    .bot   { justify-content: flex-start; }
    .bot .bubble   { background: #ffffff; border: 1px solid #e5e7eb; }
    .user  { justify-content: flex-end; }
    .user .bubble  { background: #dbeafe; border: 1px solid #bfdbfe; }

    .avatar {
      flex: none;
      width: 32px; height: 32px;
      border-radius: 50%;
      display: grid; place-items: center;
      font-size: 18px;
      background: #e0ecff;
      border: 1px solid #c7ddff;
      color: #1e40af;
    }

    /* Thanh nh·∫≠p c·ªë ƒë·ªãnh d∆∞·ªõi c√πng */
    .composer {
      position: fixed; left: 0; right: 0; bottom: 0;
      background: #ffffff;
      border-top: 1px solid #e5e7eb;
      padding: 10px 12px;
      display: flex; gap: 8px;
      align-items: center;
    }
    .composer__wrap {
      max-width: 1100px; margin: 0 auto; width: 100%;
      display: flex; gap: 8px;
    }
    .input {
      flex: 1;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid #cbd5e1;
      font-size: 15px;
      outline: none;
    }
    .input:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,.15); }
    .send {
      flex: none;
      min-width: 70px;
      padding: 10px 16px;
      border-radius: 12px;
      border: 0;
      background: #3b82f6;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }
    .send[disabled] { opacity: .6; cursor: not-allowed; }

    /* Loading dots */
    .dots { display: inline-block; width: 22px; text-align: left }
    .dots:after {
      content: "‚Ä¶";
      animation: dots 1.2s steps(4, end) infinite;
    }
    @keyframes dots {
      0% { content:""; } 25% { content:"."; }
      50% { content:".."; } 75% { content:"..."; } 100% { content:""; }
    }

    @media (max-width: 600px) {
      .guide { border-radius: 12px; }
      .msg .bubble { font-size: 15px; }
    }
  </style>
</head>
<body>
  <header class="appbar">CHATBOT PTC1</header>

  <main class="container">
    <!-- Th·∫ª h∆∞·ªõng d·∫´n gi·ªëng ·∫£nh -->
    <section class="guide" aria-label="H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng">
      <h3>ü§ñ Ch√†o b·∫°n! T√¥i c√≥ th·ªÉ gi√∫p b·∫°n tra c·ª©u th√¥ng tin v·ªÅ TBA, MBA, SMBA, BDA, CAP, TC, MC, DCL, KH, TB, CS, TU, TI, r∆° le, AQ, MNAQ.</h3>
      <p>Vui l√≤ng nh·∫≠p ƒë√∫ng c√∫ ph√°p ƒë·ªÉ tra c·ª©u: <em>[thi·∫øt b·ªã c·∫ßn t√¨m, t√™n tr·∫°m bi·∫øn √°p, ngƒÉn l·ªô, ch·ª©c nƒÉng r∆° le ho·∫∑c ch·ªâ danh]</em>.</p>
      <ul>
        <li>üëâ V√≠ d·ª•: <strong>r∆° le, s√≥c s∆°n, 271, F21</strong></li>
        <li>üëâ V√≠ d·ª•: <strong>ti, 220kV long bi√™n, 271, TI271</strong></li>
      </ul>
    </section>

    <!-- Khung h·ªôi tho·∫°i -->
    <section id="chat" class="chat" aria-live="polite" aria-label="H·ªôi tho·∫°i">
      <!-- Tin nh·∫Øn bot m·ªü ƒë·∫ßu -->
      <div class="msg bot">
        <div class="avatar">ü§ñ</div>
        <div class="bubble">Xin ch√†o! Nh·∫≠p y√™u c·∫ßu theo c√∫ ph√°p ƒë·ªÉ m√¨nh tra c·ª©u gi√∫p b·∫°n.</div>
      </div>
    </section>
  </main>

  <!-- Thanh nh·∫≠p -->
  <div class="composer">
    <div class="composer__wrap">
      <input id="input" class="input" type="text"
             placeholder="Vui l√≤ng ch·ªçn lo·∫°i thi·∫øt b·ªã b·∫°n mu·ªën tra c·ª©u th√¥ng tin (v√≠ d·ª•: r∆° le, mc, tba)‚Ä¶"
             autocomplete="off" />
      <button id="sendBtn" class="send">G·ª≠i</button>
    </div>
  </div>

  <script>
    // ====== C·∫§U H√åNH BACKEND ======
    const API_URL = "/query"; // ƒë·ªïi n·∫øu backend c·ªßa b·∫°n d√πng ƒë∆∞·ªùng d·∫´n kh√°c

    const chat = document.getElementById("chat");
    const input = document.getElementById("input");
    const sendBtn = document.getElementById("sendBtn");

    function scrollToBottom() {
      // Cu·ªôn m∆∞·ª£t xu·ªëng cu·ªëi
      window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
    }

    function addMessage(text, role = "user") {
      const wrap = document.createElement("div");
      wrap.className = `msg ${role}`;
      const avatar = document.createElement("div");
      avatar.className = "avatar";
      avatar.textContent = role === "user" ? "üßë" : "ü§ñ";
      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.textContent = text;
      wrap.appendChild(avatar);
      wrap.appendChild(bubble);
      chat.appendChild(wrap);
      scrollToBottom();
      return bubble;
    }

    function addLoading() {
      const wrap = document.createElement("div");
      wrap.className = "msg bot";
      const avatar = document.createElement("div");
      avatar.className = "avatar";
      avatar.textContent = "ü§ñ";
      const bubble = document.createElement("div");
      bubble.className = "bubble";
      const dots = document.createElement("span");
      dots.className = "dots";
      bubble.appendChild(dots);
      wrap.appendChild(avatar);
      wrap.appendChild(bubble);
      chat.appendChild(wrap);
      scrollToBottom();
      return wrap; // tr·∫£ v·ªÅ ƒë·ªÉ x√≥a khi c√≥ k·∫øt qu·∫£
    }

    async function sendMessage() {
      const text = input.value.trim();
      if (!text) return;
      input.value = "";
      input.focus();

      addMessage(text, "user");
      const loadingEl = addLoading();
      sendBtn.disabled = true;

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text })
        });

        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        loadingEl.remove();
        addMessage(data.reply || "Kh√¥ng c√≥ d·ªØ li·ªáu tr·∫£ v·ªÅ.", "bot");
      } catch (err) {
        loadingEl.remove();
        addMessage("‚ö†Ô∏è L·ªói k·∫øt n·ªëi t·ªõi m√°y ch·ªß. Vui l√≤ng th·ª≠ l·∫°i ho·∫∑c li√™n h·ªá qu·∫£n tr·ªã.", "bot");
        console.error(err);
      } finally {
        sendBtn.disabled = false;
        scrollToBottom();
      }
    }

    // S·ª± ki·ªán
    sendBtn.addEventListener("click", sendMessage);
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
  </script>
</body>
</html>
